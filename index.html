<!-- üïäÔ∏è Sua Jornada Seu Destino ‚Äî Ora√ß√£o Interativa (PWA + Share + Cache TTS) -->
<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ora√ß√£o de B√™n√ß√£o Divina</title>
  <meta name="theme-color" content="#0b1020" />
  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="apple-touch-icon" href="./icons/icon-192.png" />

  <style>
    :root{
      --overlay: rgba(0,0,0,.45);
      --card: rgba(17,24,39,.72);
      --muted:#cbd5e1; --text:#f1f5f9;
      --primary:#a7f3d0; --accent:#fcd34d;
      --gold:#facc15; --deepgold:#ca8a04;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      color:var(--text); background:#0b1020; min-height:100vh;
    }
    .bg{position:fixed;inset:0;background:#0b1020 url('https://images.unsplash.com/photo-1503264116251-35a269479413?auto=format&fit=crop&w=1950&q=80') center/cover no-repeat;}
    .bg::after{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(2,6,23,.4),rgba(2,6,23,.75));}
    .wrap{position:relative;z-index:1;display:grid;place-items:center;min-height:100vh;padding:24px}
    .card{
      width:min(860px,96vw); background:var(--card); backdrop-filter:blur(8px);
      border-radius:18px; border:1px solid rgba(255,255,255,.08); overflow:hidden;
      box-shadow:0 20px 60px rgba(0,0,0,.45);
    }
    .header{padding:26px 26px 10px}
    .header-top{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:8px}
    .badge{
      font-weight:700;color:#e2e8f0;background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);padding:8px 12px;border-radius:10px
    }
    .channel-icon{
      display:inline-flex;align-items:center;gap:8px;text-decoration:none;
      background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);
      padding:6px 10px;border-radius:12px;color:#e2e8f0;font-weight:600;transition:.25s ease
    }
    .channel-icon:hover{border-color:rgba(255,255,255,.25);transform:translateY(-1px)}
    .channel-icon img{width:48px;height:48px;border-radius:10px;display:block}
    h1{margin:0 0 6px;font-size:28px}
    p.desc{margin:0;color:var(--muted)}
    p.desc b.highlight{color:var(--accent)}
    .content{padding:18px 22px 6px}
    label{display:block;margin-bottom:6px;font-weight:600}
    input,select,button{
      width:100%;border-radius:12px;border:1px solid rgba(255,255,255,.1);
      background:rgba(4,6,16,.75);color:var(--text);padding:12px 14px;font-size:15px
    }
    button.primary{
      background:linear-gradient(135deg,var(--primary),#34d399);border:none;font-weight:700;
      color:#04140f;cursor:pointer;transition:.3s ease
    }
    button.primary:hover{box-shadow:0 0 25px 6px rgba(52,211,153,.4);transform:scale(1.02)}
    .linkbtn{
      border-radius:12px;padding:12px 14px;font-size:15px;font-weight:700;text-align:center;cursor:pointer;
      text-decoration:none;display:inline-flex;align-items:center;justify-content:center;transition:.25s ease;
      width:100%;min-height:48px
    }
    .linkbtn.youtube{background:linear-gradient(135deg,#ff6b6b,#ff3b3b);color:#fff}
    .linkbtn.whatsapp{background:linear-gradient(135deg,#34d399,#16a34a);color:#04140f}
    .linkbtn.instagram{background:linear-gradient(135deg,#ff6db3,#e1306c);color:#fff}
    .linkbtn.telegram{background:linear-gradient(135deg,#2AABEE,#229ED9);color:#fff}
    .linkbtn.download{
      background:linear-gradient(135deg,var(--gold),var(--deepgold));
      color:#1f1f1f;border:none;font-weight:800;gap:10px;box-shadow:0 0 15px rgba(250,204,21,.35)
    }
    .cta-grid{display:grid;gap:12px;margin-top:12px;grid-template-columns:repeat(2,1fr)}
    @media(max-width:560px){.cta-grid{grid-template-columns:1fr}}

    /* Barra de progresso larga */
    .progress-wrap{margin:10px 0 4px}
    .progress-container{
      width:100%;height:10px;background:rgba(255,255,255,.10);border-radius:10px;overflow:hidden;display:none
    }
    .progress-bar{
      height:100%;width:0%;background:linear-gradient(90deg,var(--gold),var(--deepgold));
      box-shadow:0 0 12px rgba(250,204,21,.6);animation:shimmer 2s infinite linear
    }
    @keyframes shimmer{0%{filter:brightness(1)}50%{filter:brightness(1.5)}100%{filter:brightness(1)}}

    /* Status entre nome e bot√£o */
    .status-pill{
      margin:10px 0 10px;padding:12px 14px;border-radius:12px;font-weight:700;letter-spacing:.2px;
      display:flex;align-items:center;gap:10px;border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);color:#e2e8f0;box-shadow:0 8px 28px rgba(0,0,0,.25)
    }
    .status-pill.ok{
      background:linear-gradient(135deg,#34d399,#10b981);color:#062e28;border-color:rgba(16,185,129,.35)
    }
    .status-pill.err{
      background:linear-gradient(135deg,#fca5a5,#ef4444);color:#3b0a0a;border-color:rgba(239,68,68,.35)
    }
    .status-pill.loading{
      background:linear-gradient(135deg,#fcd34d,#f59e0b);color:#1f2937;border-color:rgba(245,158,11,.35)
    }
    .status-pill.loading::before{content:"‚è≥"} .status-pill.ok::before{content:"‚ú®"} .status-pill.err::before{content:"‚ùå"}
  </style>
</head>

<body>
  <div class="bg"></div>
  <div class="wrap">
    <div class="card">
      <div class="header">
        <div class="header-top">
          <div class="badge">Sua Jornada Seu Destino</div>
          <a class="channel-icon" href="https://www.youtube.com/@suajornadaseudestino" target="_blank" rel="noopener">
            <img src="./icons/canal.png" alt="Canal"><span>Canal</span>
          </a>
        </div>
        <h1>Ora√ß√£o de B√™n√ß√£o Divina</h1>
        <p class="desc">Escolha o tipo, digite o nome e clique em <b class="highlight">Ouvir Ora√ß√£o</b>.</p>
      </div>

      <div class="content">
        <label for="tipo">Escolha a ora√ß√£o:</label>
        <select id="tipo">
          <option value="bencao">Ora√ß√£o de B√™n√ß√£o Divina</option>
          <option value="gratidao">Ora√ß√£o de Gratid√£o</option>
          <option value="aniversario">Ora√ß√£o de Anivers√°rio</option>
          <option value="manha">Ora√ß√£o da Manh√£</option>
          <option value="noite">Ora√ß√£o da Noite</option>
          <option value="protecao">Ora√ß√£o de Prote√ß√£o</option>
        </select>

        <div style="height:10px"></div>
        <label for="nome">Nome a receber a Ben√ß√£o!</label>
        <input id="nome" placeholder="Ex.: Ana Clara" />

        <!-- STATUS (entre o nome e o bot√£o) -->
        <div id="status" class="status-pill" aria-live="polite" role="status">
          Escolha a ora√ß√£o o<b>nome</b>clique<b>Ouvir</b>.
        </div>

        <!-- Progresso largo -->
        <div class="progress-wrap">
          <div class="progress-container" id="progress">
            <div class="progress-bar" id="progress-bar"></div>
          </div>
        </div>

        <button id="btn-ouvir" type="button" class="primary">üéß Ouvir ora√ß√£o</button>
        <a id="btn-download" class="linkbtn download" href="#" download style="display:none">üîä Baixar √∫ltimo √°udio</a>

        <div class="cta-grid">
          <a class="linkbtn youtube" href="https://www.youtube.com/@suajornadaseudestino" target="_blank" rel="noopener">‚ñ∂Ô∏è Canal</a>
          <button id="btn-whats" class="linkbtn whatsapp">üü¢ WhatsApp</button>
          <a class="linkbtn instagram" href="https://www.instagram.com/suajornadaseudestino/" target="_blank" rel="noopener">üì∏ Instagram</a>
          <button id="btn-telegram" class="linkbtn telegram">‚úàÔ∏è Telegram</button>
        </div>

        <label style="display:flex;align-items:center;gap:8px;margin-top:10px;">
          <input type="checkbox" id="mute-sounds" /> Silenciar som de conclus√£o
        </label>
      </div>

      <div class="player"><audio id="player" controls style="width:100%"></audio></div>
    </div>
  </div>

  <!-- Som de harpa (curtinho) -->
  <audio id="harpa" preload="auto"
    src="data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACaQCAAQAAABhzdHNkAAAAAAAAAABP/////wAAAABJbmZvAAAAPAAAABAAAAEgYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYQ==">
  </audio>

  <script>
    /* ====== Config ====== */
    const ENDPOINT = "https://oracaooo.onrender.com/tts";
    const DEFAULT_VOICE_ID = "4YYIPFl9wE5c4L2eu2Gb";

    /* ====== Elos ====== */
    const nomeInput = document.getElementById('nome');
    const statusEl  = document.getElementById('status');
    const player    = document.getElementById('player');
    const btnOuvir  = document.getElementById('btn-ouvir');
    const btnDownload = document.getElementById('btn-download');
    const progress  = document.getElementById('progress');
    const bar       = document.getElementById('progress-bar');
    const harpa     = document.getElementById('harpa');
    const chkMute   = document.getElementById('mute-sounds');

    /* ====== Status helpers ====== */
    function setStatus(texto, classe){
      statusEl.classList.remove('ok','err','loading');
      if (classe) statusEl.classList.add(classe);
      statusEl.innerHTML = texto;
    }

    /* ====== Prefer√™ncia de som ====== */
    if (harpa) harpa.volume = 0.35;
    const setMuted = (m)=>{harpa.muted=m;localStorage.setItem('oracao.muted',m?'1':'0');};
    chkMute.addEventListener('change',()=>setMuted(chkMute.checked));
    (()=>{ const m=localStorage.getItem('oracao.muted')==='1'; chkMute.checked=m; setMuted(m); })();

    /* ====== Textos (em par√°grafos) ====== */
    const ORACOES = {
      bencao: [
`{{nome}}, respire fundo... Agora, receba esta ora√ß√£o.

O Senhor te chama pelo nome. Que a paz que excede todo entendimento preencha o teu cora√ß√£o.
Onde houver medo, que entre a confian√ßa; onde houver dor, que flores√ßa cura; onde houver d√∫vida, que se levante a f√©.`,
`Que a luz de Deus ilumine teus passos hoje e sempre.
Que Ele te cubra com favor diante dos homens e te guie com sabedoria em cada decis√£o.`,
`Seja sua vida aben√ßoada, {{nome}}. Que a gra√ßa do Alt√≠ssimo te envolva agora e para sempre. Am√©m.`
      ],
      gratidao: [
`{{nome}}, hoje levantamos a nossa voz em gratid√£o.
Pelo dom da vida, pelas pequenas alegrias, pelos livramentos que nem vimos.`,
`Que teu cora√ß√£o se encha de reconhecimento, e que a gratid√£o abra portas de favor.
Onde houver murm√∫rio, que nas√ßa louvor; onde houver falta, que flores√ßa provis√£o.`,
`Obrigado, Senhor, por tudo que j√° fizeste e pelo que ainda far√°s na vida de {{nome}}. Am√©m.`
      ],
      aniversario: [
`Hoje, Senhor, agradecemos pela vida de {{nome}}.
Cada ano √© um presente Teu, uma nova chance de florescer na f√©, na sabedoria e no amor.`,
`Aben√ßoa os caminhos de {{nome}}, trazendo sa√∫de, alegria e realiza√ß√µes.
Que os sonhos se renovem, que a esperan√ßa nunca se apague e que Tua luz te conduza em cada passo.`,
`Parab√©ns, {{nome}}! Que a gra√ßa divina te envolva hoje e sempre. Am√©m.`
      ],
      manha: [
`{{nome}}, ao despertar, acolhe a luz de Deus.
Que teus pensamentos sejam guiados pela sabedoria, e tuas decis√µes, pela paz.`,
`Onde houver ansiedade, que reine calma; onde houver cansa√ßo, que venha √¢nimo.
Senhor, aben√ßoa o caminho de {{nome}} neste dia, e firma seus passos.`,
`Que a Tua presen√ßa acompanhe {{nome}} desde agora e para sempre. Am√©m.`
      ],
      noite: [
`{{nome}}, que o descanso desta noite seja guardado pelo Alt√≠ssimo.
Que os anjos acampem ao teu redor, e toda inquieta√ß√£o se transforme em serenidade.`,
`O que foi dor, seja cura; o que foi peso, aprendizado.
Derrama, Senhor, Tua paz sobre o cora√ß√£o de {{nome}}.`,
`Dorme em paz, {{nome}}. Deus vela por ti. Am√©m.`
      ],
      protecao: [
`{{nome}}, que o Senhor seja teu escudo e a tua fortaleza.
Que nenhum mal alcance tua morada e teus passos sejam firmados na luz.`,
`Que a presen√ßa de Deus afaste toda sombra e te revista de coragem.
Anjos do Senhor, acampem ao redor de {{nome}} e sustentem sua vida.`,
`Cobre, Senhor, a vida de {{nome}} com prote√ß√£o hoje e sempre. Am√©m.`
      ]
    };

    /* ====== Cache TTS no Cache Storage ====== */
    const TTS_CACHE_NAME='tts-audios-v1';
    async function sha256Hex(s){
      const buf=await crypto.subtle.digest('SHA-256',new TextEncoder().encode(s));
      return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
    }
    async function getFromCache(key){const c=await caches.open(TTS_CACHE_NAME);const r=await c.match(new Request(key));return r?await r.blob():null;}
    async function putInCache(key,b){const c=await caches.open(TTS_CACHE_NAME);await c.put(new Request(key),new Response(b,{headers:{'Content-Type':'audio/mpeg'}}));}
    async function getOrGenerateAudio({text,voiceId}){
      const key='/tts-cache/'+await sha256Hex(voiceId+'::'+text);
      const cached=await getFromCache(key);
      if(cached&&cached.size>0) return{blob:cached,fromCache:true};
      const r=await fetch(ENDPOINT,{
        method:'POST',mode:'cors',
        headers:{'Content-Type':'application/json','Accept':'audio/mpeg'},
        body:JSON.stringify({text,voiceId})
      });
      if(!r.ok) throw new Error(r.status);
      const blob=await r.blob();
      putInCache(key,blob).catch(()=>{});
      return{blob,fromCache:false};
    }

    /* ====== Gerar √°udio + UI ====== */
    async function gerarAudio(){
      const tipo=document.getElementById('tipo').value;
      const nome=(nomeInput.value||'').trim();

      // junta par√°grafos e personaliza {{nome}}
      const texto = (ORACOES[tipo] || [])
        .map(p => p.replace(/\{\{\s*nome\s*\}\}/gi, nome || ''))
        .join('\n\n');

      setStatus('üôè Preparando a ora√ß√£o...', 'loading');
      progress.style.display='block'; bar.style.width='0%';
      btnOuvir.disabled=true;

      // progresso ‚Äúfake‚Äù enquanto o backend processa
      let pct=0;
      const loader=setInterval(()=>{pct=Math.min(pct+Math.random()*15,95);bar.style.width=pct+'%';},380);

      try{
        const {blob,fromCache}=await getOrGenerateAudio({text:texto,voiceId:DEFAULT_VOICE_ID});
        clearInterval(loader); bar.style.width='100%'; setTimeout(()=>progress.style.display='none',700);

        const url=URL.createObjectURL(blob);
        player.src=url; player.play().catch(()=>{});

        btnDownload.href=url;
        btnDownload.download=`oracao-${tipo}-${(nome||'bencao').toLowerCase().replace(/\s+/g,'-')}.mp3`;
        btnDownload.style.display='inline-flex';

        setStatus(fromCache ? '‚ö° Ora√ß√£o carregada instantaneamente!' : '‚ú® Ora√ß√£o gerada com sucesso!', 'ok');

        // som de conclus√£o
        harpa?.pause(); try{harpa.currentTime=0;}catch{}; harpa?.play().catch(()=>{});
      }catch(e){
        clearInterval(loader); progress.style.display='none';
        setStatus('‚ùå Erro ao gerar √°udio. Tente novamente.', 'err');
        console.error('[TTS] Falha:', e);
      }finally{
        btnOuvir.disabled=false;
      }
    }
    btnOuvir.addEventListener('click',gerarAudio);

    /* ====== Compartilhamento ====== */
    const SITE_URL = location.origin + location.pathname;
    function montarMsg(){
      const n=(nomeInput.value||'').trim();
      const prefix = n ? `${n}, ` : '';
      return `${prefix}receba esta Ora√ß√£o de B√™n√ß√£o Divina üôè

Ou√ßa sua ora√ß√£o aqui:
${SITE_URL}

Que Deus ilumine seus passos hoje e sempre. Am√©m.`;
    }
    document.getElementById('btn-whats')?.addEventListener('click',()=>{
      const msg=montarMsg();
      if(navigator.share){ navigator.share({title:'Ora√ß√£o de B√™n√ß√£o Divina',text:msg,url:SITE_URL}).catch(()=>{}); return; }
      window.open('https://wa.me/?text='+encodeURIComponent(msg),'_blank','noopener');
    });
    document.getElementById('btn-telegram')?.addEventListener('click',()=>{
      const msg=montarMsg();
      const tg=`https://t.me/share/url?url=${encodeURIComponent(SITE_URL)}&text=${encodeURIComponent(msg)}`;
      window.open(tg,'_blank','noopener');
    });

    /* ====== PWA ====== */
    if("serviceWorker" in navigator){
      navigator.serviceWorker.register("./sw.js").catch(console.error);
    }
  </script>
</body>
</html>
