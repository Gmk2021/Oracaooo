<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ora√ß√£o de B√™n√ß√£o Divina</title>
  <meta name="theme-color" content="#0b1020" />
  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="apple-touch-icon" href="./icons/icon-192.png" />
  <style>
    :root{--card:rgba(17,24,39,.72);--text:#f1f5f9;--primary:#a7f3d0;--accent:#fcd34d;--gold:#facc15;--deepgold:#ca8a04}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--text);background:#0b1020;min-height:100vh}
    .wrap{display:grid;place-items:center;min-height:100vh;padding:24px}
    .card{width:min(860px,96vw);background:var(--card);backdrop-filter:blur(8px);border-radius:18px;border:1px solid rgba(255,255,255,.08);box-shadow:0 20px 60px rgba(0,0,0,.45)}
    .header{padding:26px}
    .badge{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);padding:8px 12px;border-radius:10px;font-weight:700}
    .channel-icon{display:inline-flex;align-items:center;gap:8px;text-decoration:none;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);padding:6px 10px;border-radius:12px;color:#e2e8f0;font-weight:600;float:right}
    h1{margin:0 0 6px;font-size:28px}
    p.desc{margin:0;color:#cbd5e1}
    input,select,button{width:100%;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:rgba(4,6,16,.75);color:var(--text);padding:12px 14px;font-size:15px}
    button.primary{background:linear-gradient(135deg,var(--primary),#34d399);border:none;font-weight:700;color:#04140f;cursor:pointer}
    button.primary:hover{transform:scale(1.02)}
    .progress-container{width:100%;height:10px;background:rgba(255,255,255,.10);border-radius:10px;overflow:hidden;display:none}
    .progress-bar{height:100%;width:0%;background:linear-gradient(90deg,var(--gold),var(--deepgold));box-shadow:0 0 12px rgba(250,204,21,.6)}
    .status-pill{margin:10px 0;padding:12px 14px;border-radius:12px;font-weight:700;display:flex;align-items:center;gap:10px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.06)}
    .status-pill.ok{background:linear-gradient(135deg,#34d399,#10b981);color:#062e28}
    .status-pill.err{background:linear-gradient(135deg,#fca5a5,#ef4444);color:#3b0a0a}
    .status-pill.loading{background:linear-gradient(135deg,#fcd34d,#f59e0b);color:#1f2937}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="header">
        <div class="badge">Sua Jornada Seu Destino</div>
        <a class="channel-icon" href="https://www.youtube.com/@suajornadaseudestino" target="_blank">
          <img src="./icons/canal.png" width="40"> Canal
        </a>
        <h1>Ora√ß√£o de B√™n√ß√£o Divina</h1>
        <p class="desc">Escolha o tipo, digite o nome e clique em <b>Ouvir Ora√ß√£o</b>.</p>
      </div>
      <div style="padding:20px">
        <label>Tipo de ora√ß√£o:</label>
        <select id="tipo">
          <option value="bencao">B√™n√ß√£o Divina</option>
          <option value="gratidao">Gratid√£o</option>
          <option value="aniversario">Anivers√°rio</option>
          <option value="manha">Manh√£</option>
          <option value="noite">Noite</option>
          <option value="protecao">Prote√ß√£o</option>
        </select>
        <br><br>
        <label>Nome:</label>
        <input id="nome" placeholder="Ex: Ana Clara">
        <div id="status" class="status-pill">Pronto para gerar ora√ß√£o üôè</div>
        <div class="progress-container" id="progress"><div class="progress-bar" id="progress-bar"></div></div>
        <button id="btn-ouvir" class="primary">üéß Ouvir Ora√ß√£o</button>
        <a id="btn-download" class="primary" style="display:none;margin-top:10px;text-align:center;text-decoration:none;">üîä Baixar √Åudio</a>
        <audio id="player" controls style="width:100%;margin-top:10px"></audio>
      </div>
    </div>
  </div>

  <!-- √°udio embutido -->
  <audio id="harpa" preload="auto"
    src="data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACaQCAAQAAABhzdHNkAAAAAAAAAABP/////wAAAABJbmZvAAAAPAAAABAAAAEgYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYQ==">
  </audio>

  <script>
    const ENDPOINT = "https://oracaooo.onrender.com/tts";
    const DEFAULT_VOICE_ID = "4YYIPFl9wE5c4L2eu2Gb";
    const nomeInput = document.getElementById('nome');
    const tipoSel = document.getElementById('tipo');
    const statusEl = document.getElementById('status');
    const player = document.getElementById('player');
    const btnOuvir = document.getElementById('btn-ouvir');
    const btnDownload = document.getElementById('btn-download');
    const progress = document.getElementById('progress');
    const bar = document.getElementById('progress-bar');

    /* ====== HARPA FALLBACK ====== */
    window.__harpaMuted = false;
    function playChimeFallback(){
      if(window.__harpaMuted) return;
      const ac = new (window.AudioContext || window.webkitAudioContext)();
      const now = ac.currentTime;
      const gain = ac.createGain(); gain.gain.value = 0.2; gain.connect(ac.destination);
      const o1 = ac.createOscillator(); o1.type='sine'; o1.frequency.setValueAtTime(880,now);
      const o2 = ac.createOscillator(); o2.type='sine'; o2.frequency.setValueAtTime(1174.66,now);
      const g1 = ac.createGain(); g1.gain.setValueAtTime(0,now); g1.gain.linearRampToValueAtTime(1,now+0.01); g1.gain.exponentialRampToValueAtTime(0.001,now+0.4);
      const g2 = ac.createGain(); g2.gain.setValueAtTime(0,now); g2.gain.linearRampToValueAtTime(0.8,now+0.03); g2.gain.exponentialRampToValueAtTime(0.001,now+0.6);
      o1.connect(g1).connect(gain); o2.connect(g2).connect(gain);
      o1.start(now); o1.stop(now+0.5); o2.start(now+0.03); o2.stop(now+0.65);
    }
    async function playHarp(){
      if(window.__harpaMuted) return;
      const harpa=document.getElementById('harpa');
      try{ harpa.muted=false; harpa.volume=0.5; harpa.currentTime=0; await harpa.play(); }catch{ playChimeFallback(); }
    }

    function setStatus(txt,cls){
      statusEl.classList.remove('ok','err','loading');
      if(cls) statusEl.classList.add(cls);
      statusEl.innerHTML = txt;
    }
    const ORACOES = {
      bencao: [
`{{nome}}, respire fundo... Agora, receba esta ora√ß√£o.

O Senhor te chama pelo nome. Que a paz que excede todo entendimento preencha o teu cora√ß√£o.
Onde houver medo, que entre a confian√ßa; onde houver dor, que flores√ßa cura; onde houver d√∫vida, que se levante a f√©.`,
`Que a luz de Deus ilumine teus passos hoje e sempre.
Que Ele te cubra com favor diante dos homens e te guie com sabedoria em cada decis√£o.`,
`Seja tua vida aben√ßoada, {{nome}}. Que a gra√ßa do Alt√≠ssimo te envolva agora e para sempre. Am√©m.`
      ],
      gratidao: [
`{{nome}}, hoje levantamos a nossa voz em gratid√£o.
Pelo dom da vida, pelas pequenas alegrias, pelos livramentos que nem vimos.`,
`Que teu cora√ß√£o se encha de reconhecimento, e que a gratid√£o abra portas de favor.
Onde houver murm√∫rio, que nas√ßa louvor; onde houver falta, que flores√ßa provis√£o.`,
`Obrigado, Senhor, por tudo que j√° fizeste e pelo que ainda far√°s na vida de {{nome}}. Am√©m.`
      ],
      aniversario: [
`Hoje, Senhor, agradecemos pela vida de {{nome}}.
Cada ano √© um presente Teu, uma nova chance de florescer na f√©, na sabedoria e no amor.`,
`Aben√ßoa os caminhos de {{nome}}, trazendo sa√∫de, alegria e realiza√ß√µes.
Que os sonhos se renovem, que a esperan√ßa nunca se apague e que Tua luz te conduza em cada passo.`,
`Parab√©ns, {{nome}}! Que a gra√ßa divina te envolva hoje e sempre. Am√©m.`
      ],
      manha: [
`{{nome}}, ao despertar, acolhe a luz de Deus.
Que teus pensamentos sejam guiados pela sabedoria, e tuas decis√µes, pela paz.`,
`Onde houver ansiedade, que reine calma; onde houver cansa√ßo, que venha √¢nimo.
Senhor, aben√ßoa o caminho de {{nome}} neste dia, e firma seus passos.`,
`Que a Tua presen√ßa acompanhe {{nome}} desde agora e para sempre. Am√©m.`
      ],
      noite: [
`{{nome}}, que o descanso desta noite seja guardado pelo Alt√≠ssimo.
Que os anjos acampem ao teu redor, e toda inquieta√ß√£o se transforme em serenidade.`,
`O que foi dor, seja cura; o que foi peso, aprendizado.
Derrama, Senhor, Tua paz sobre o cora√ß√£o de {{nome}}.`,
`Dorme em paz, {{nome}}. Deus vela por ti. Am√©m.`
      ],
      protecao: [
`{{nome}}, que o Senhor seja teu escudo e a tua fortaleza.
Que nenhum mal alcance tua morada e teus passos sejam firmados na luz.`,
`Que a presen√ßa de Deus afaste toda sombra e te revista de coragem.
Anjos do Senhor, acampem ao redor de {{nome}} e sustentem sua vida.`,
`Cobre, Senhor, a vida de {{nome}} com prote√ß√£o hoje e sempre. Am√©m.`
      ]
    };
const TTS_CACHE_NAME='tts-audios-v1';
    async function sha256Hex(s){const b=await crypto.subtle.digest('SHA-256',new TextEncoder().encode(s));return Array.from(new Uint8Array(b)).map(b=>b.toString(16).padStart(2,'0')).join('');}
    async function getFromCache(k){const c=await caches.open(TTS_CACHE_NAME);const r=await c.match(new Request(k));return r?await r.blob():null;}
    async function putInCache(k,b){const c=await caches.open(TTS_CACHE_NAME);await c.put(new Request(k),new Response(b,{headers:{'Content-Type':'audio/mpeg'}}));}
    async function getOrGenerateAudio({text,voiceId}){
      const key='/tts-cache/'+await sha256Hex(voiceId+'::'+text);
      const cached=await getFromCache(key);
      if(cached) return{blob:cached,fromCache:true};
      const r=await fetch(ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json','Accept':'audio/mpeg'},body:JSON.stringify({text,voiceId})});
      if(!r.ok) throw new Error(r.status);
      const blob=await r.blob(); putInCache(key,blob); return{blob,fromCache:false};
    }

    async function gerarAudio(){
      const tipo=tipoSel.value, nome=(nomeInput.value||'').trim();
      const texto=(ORACOES[tipo]||[]).map(p=>p.replace(/\{\{\s*nome\s*\}\}/gi,nome)).join('\n\n');
      setStatus('‚è≥ Gerando √°udio...', 'loading');
      progress.style.display='block'; bar.style.width='0%';
      let pct=0; const loader=setInterval(()=>{pct=Math.min(pct+Math.random()*12,95);bar.style.width=pct+'%';},400);
      try{
        const {blob}=await getOrGenerateAudio({text:texto,voiceId:DEFAULT_VOICE_ID});
        clearInterval(loader); bar.style.width='100%'; setTimeout(()=>progress.style.display='none',700);
        const url=URL.createObjectURL(blob);
        player.src=url; player.play();
        btnDownload.href=url; btnDownload.style.display='block';
        setStatus('‚ú® Ora√ß√£o gerada com sucesso!', 'ok');
        playHarp();
      }catch(e){
        clearInterval(loader); progress.style.display='none';
        setStatus('‚ùå Erro ao gerar √°udio.', 'err');
        console.error(e);
      }
    }
    btnOuvir.addEventListener('click',gerarAudio);
  </script>
</body>
</html>
